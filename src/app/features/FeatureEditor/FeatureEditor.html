<tractor-file-tree model="featureEditor" type="feature"></tractor-file-tree>
<tractor-resize-handle></tractor-resize-handle>
<form class="file" name="feature-editor" novalidate
    ng-submit="featureEditor.showErrors() && featureEditor.saveFeatureFile()">
    <section class="file-options">
        <h1 class="file-options__name">{{ featureEditor.feature.name }}</h1>
        <div>
            <tractor-text-input class="file-options__name-input"
                ng-if="!featureEditor.feature.isSaved"
                form="feature-editor"
                label="Name"
                model="featureEditor.feature"
                example="Feature">
            </tractor-text-input>
            <tractor-submit class="file-options__save-file"
                action="Save feature file">
            </tractor-submit>
        </div>
    </section>

    <section class="file-editor">
        <section ng-show="featureEditor.feature.name">
            <section class="file-editor__container">
                <h2>Feature:</h2>

                <tractor-text-input
                    form="feature-editor"
                    label="In order to"
                    model="featureEditor.feature"
                    example="achieve some goal">
                </tractor-text-input>
                <tractor-text-input
                    form="feature-editor"
                    label="As a"
                    model="featureEditor.feature"
                    example="certain type of user">
                </tractor-text-input>
                <tractor-text-input
                    form="feature-editor"
                    label="I want"
                    model="featureEditor.feature"
                    example="to be able to do something">
                </tractor-text-input>
            </section>

            <section class="file-editor__container">
                <h2>Scenarios:</h2>

                <ul ng-if="featureEditor.feature.scenarios.length">
                    <li class="file-editor__list-item" ng-repeat="scenario in featureEditor.feature.scenarios">
                        <tractor-action
                            model="featureEditor.feature"
                            action="Remove scenario"
                            argument="scenario"
                            icon="remove"></tractor-action>

                        <tractor-text-input
                            form="feature-editor"
                            label="Name"
                            model="scenario"
                            example="Scenario">
                        </tractor-text-input>

                        <section>
                            <h3>Step Declarations:</h3>

                            <ol ng-if="scenario.stepDeclarations.length" as-sortable ng-model="scenario.stepDeclarations" is-disabled="scenario.stepDeclarations.length < 2">
                                <li class="file-editor__list-item" ng-repeat="stepDeclaration in scenario.stepDeclarations" as-sortable-item>
                                    <tractor-action
                                        model="scenario"
                                        action="Remove step declaration"
                                        argument="stepDeclaration"
                                        icon="remove">
                                    </tractor-action>
                                    <div ng-if="scenario.stepDeclarations.length > 1" class="file-editor__sort-handle" as-sortable-item-handle title="Drag to sort"></div>

                                    <tractor-select label="Type" model="stepDeclaration"></tractor-select>
                                    <tractor-step-input
                                        form="feature-editor"
                                        label="Step"
                                        model="stepDeclaration"
                                        example="something happens">
                                    </tractor-step-input>
                                </li>
                            </ol>

                            <tractor-action
                                model="scenario"
                                action="Add step declaration">
                            </tractor-action>
                        </section>

                        <section ng-show="scenario.exampleVariables.length">
                            <h3>Examples:</h3>
                            <ul>
                                <li class="file-editor__list-item" ng-repeat="example in scenario.examples">
                                    <tractor-action
                                        model="scenario"
                                        action="Remove example"
                                        argument="example"
                                        icon="remove">
                                    </tractor-action>

                                    <tractor-literal-input ng-repeat="exampleVariable in scenario.exampleVariables"
                                        form="feature-editor"
                                        name="exampleVariable"
                                        model="example.values[exampleVariable]"
                                        type="argument.type">
                                    </tractor-literal-input>
                                </li>
                            </ul>

                            <tractor-action
                                model="scenario"
                                action="Add example">
                            </tractor-action>
                        </section>
                    </li>
                </ul>

                <tractor-action
                    model="featureEditor.feature"
                    action="Add scenario">
                </tractor-action>
            </section>
        </section>
    </section>
</form>
